<#include "/admin/plugins/forms/commons.html" />
<@formBreadCrumb>
    <li><a href="jsp/admin/plugins/forms/ManageSteps.jsp?view=manageSteps&id_form=${step.idForm}" title="Retour Formulaire">...</i></a></li>
    <li><a href="jsp/admin/plugins/forms/ManageQuestions.jsp?view=manageQuestions&id_step=${step.id}" title="Retour Etape">${step.title}</a></li>
    <li class="active">#i18n{forms.modify_transition_control.title}</li></ul>
</@formBreadCrumb>
<@box>
    <@boxHeader title='#i18n{forms.modify_transition_control.title}' boxTools=true >
        <#if control.id gt 0>
            <@aButton href='jsp/admin/plugins/forms/ManageControls.jsp?view=confirmRemoveControl&id_control=${control.id}' title='#i18n{forms.manage_controls.action.removeControl}' buttonIcon='trash' class='pull-right text-danger' color='btn-link' />
        </#if>
    </@boxHeader>
    <@boxBody>
        <@tform class="form-horizontal" method="post" id="modify_control" name="modify_control" action="jsp/admin/plugins/forms/ManageControls.jsp">
            <@messages errors=errors />
            <@formGroup labelKey='#i18n{forms.modify_control.labelStep}' helpKey='#i18n{forms.modify_control.labelStep.help}' mandatory=true>
                 <@inputGroup>
                     <@select name='id_step' items=availableSteps default_value='${id_step!}' />
                     <@inputGroupItem>
	                     <@button type='submit' name="view_modifyControl" value="validateStep" showTitle=false buttonIcon='check'/>
	                 </@inputGroupItem>
                 </@inputGroup>
            </@formGroup>
         	<@formGroup labelKey='#i18n{forms.modify_control.labelQuestion}' helpKey='#i18n{forms.modify_control.labelQuestion.help}' mandatory=true>
                 <@inputGroup>
                     <@select name='id_question' items=listQuestion default_value='' />
                     <@inputGroupItem>
	                     <@button type='submit' name="view_modifyControl" value="validateQuestion" showTitle=false buttonIcon='check'/>
	                 </@inputGroupItem>
                 </@inputGroup>
		<#if control.listIdQuestion??>
		<#list control.listIdQuestion as question >
			<#list listQuestion as q >
				<#if question == q.code?number>
					<a href="jsp/admin/plugins/forms/ManageControls.jsp?view=modifyControl&removeQuestion=removeQuestion&id_step=${id_step!}&id_rm_question=${question}" title="remove"><i class="fa fa-trash" aria-hidden="true"></i>${q.name!}</i></a>
				</#if>
			</#list>
		</#list>	
		</#if>
            </@formGroup>
	

            <@formGroup labelKey='#i18n{forms.modify_control.labelValidator}' helpKey='#i18n{forms.modify_control.labelValidator.help}' mandatory=true>
                <@inputGroup>
                    <@select name='validatorName' items=availableValidators default_value='${control.validatorName!}' />
                    <@inputGroupItem>
	                    <@button type='submit' name="view_modifyControl" value="validateValidator" showTitle=false buttonIcon='check'/>
	                </@inputGroupItem>
                 </@inputGroup>
            </@formGroup>
			<@formGroup labelKey='#i18n{forms.modify_control.labelErrorMessage}' helpKey='#i18n{forms.modify_control.labelErrorMessage.help}' >
				<@inputGroup>
					<@input type='text' name='errorMessage' value='${control.errorMessage!}' />
				</@inputGroup>
			</@formGroup>
			
            ${control_template}
            
            <@formsButton okAction='modifyControl' viewAction='' />
            
        </@tform>
    </@boxBody>
</@box>

<script>
$( function(){
    var formAction = $('#modify_control'), btnAction = $('#action_modifyControl');
    $('body').css( 'overflow', 'hidden' );
    $('.content-header').hide();
    $('#admin-wrapper').css( 'margin', '0' ).css( 'overflow', 'hidden' );
    $('header').remove();
    $('#breadforms').remove();
    $('#footer').remove();

    btnAction.click( function(e){ 
        formAction.submit( function(){
            e.preventDefault();
            // formAction.attr('target','_top');
            _this.unbind('submit').submit();
        });
    });
});
</script>