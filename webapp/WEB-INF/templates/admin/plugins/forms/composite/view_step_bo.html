<#if current_step_index?? && current_step_index=0><#assign current_step_index = ' &gt; ' /></#if>
<@box>
	<@boxHeader title=step.title params='data-step="${current_step_index!}"' />
	<@boxBody id='step-content'>
    ${stepContent}
    <input type="hidden" name="token" value = "${token!}">
    <input name="page" value="forms" type="hidden">
    <input name="id_form" value="${step.idForm}" type="hidden">
    <input name="id_step" value="${step.id}" type="hidden">
    <#if !step.initial><button class="btn btn-primary btn-sm" name="action_doReturnStep"  type="submit" formnovalidate >#i18n{forms.step.previous}</button></#if>
    <#if step.final>
        <#if form.displaySummary >
          <button class="btn btn-primary btn-sm" name="action_formResponseSummary"  type="submit">#i18n{forms.step.see.summary}</button>
        <#else>
          <#assign label_button="#i18n{forms.step.save}" />
          <#if form.labelFinalButton?has_content>
            <#assign label_button=form.labelFinalButton />
          </#if>
          <button class="btn btn-primary btn-sm" name="action_doSaveResponse"  type="submit">${label_button}</button>
        </#if>
    <#else>
      <button class="btn btn-primary btn-sm" name="action_doSaveStep"  type="submit">#i18n{forms.step.next}</button>
    </#if>
	  <#if form.backupEnabled>
	  	<#if hasBackupResponse>
			<button class="btn btn-info btn-sm pull-right" name="action_doResetBackup"  type="submit" >#i18n{forms.step.resetResponse}</button>
		</#if>
		<button class="btn btn-info btn-sm pull-right" name="action_doSaveForBackup"  type="submit" >#i18n{forms.step.saveResponse}</button>
    </#if>
    </@boxBody>
</@box>
<script>
document.addEventListener('DOMContentLoaded', function() {
	/* Check if step-group has all field hidden due to conditional behavior */
	document.querySelectorAll('.step-group').forEach(function(stepGroup) {
		var countField = stepGroup.querySelectorAll('.form-group').length;
		var countCond = stepGroup.querySelectorAll('div[class*="display_field_"]').length;
		var countCondVisible = Array.from(stepGroup.querySelectorAll('div[class*="display_field_"]')).filter(function(el) {
			return el.offsetParent !== null;
		}).length;

		if (countField === countCond && countCond > 0 && countCondVisible === 0) {
			stepGroup.classList.add('d-none');
			stepGroup.classList.add('step-group-collapsible');
		}
	});

	/* remove required attribute */
	document.querySelectorAll('.form-control, .form-check-input, .form-select').forEach(function(el) {
		el.removeAttribute('required');
	});
});
</script>
