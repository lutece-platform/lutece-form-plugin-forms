<#assign stepTitle=step.title!?replace("- hidden","") />
<@box color='primary' id='step-${step.id}' class='step-group' params=' tabindex=0 data-title="${stepTitle}"'>
<@boxHeader title='${stepTitle} - ${form.title}' boxTools=true>
<@button type='button' color='link' params=' data-toggle="collapse" data-target="#box-step-content-${step.id}" aria-expanded="false" aria-controls="box-step-content-${step.id}"'>
    <@icon style='minus-square' />
</@button>
</@boxHeader>
<@boxBody id='box-step-content-${step.id}' class='collapse show'>
${stepContent}
</@boxBody>
</@box>
<script>
document.addEventListener('DOMContentLoaded', function() {
	/* Check if step-group has all field hidden due to conditionnal behavior */
	document.querySelectorAll('.step-group').forEach(function(stepGroup) {
		var countField = stepGroup.querySelectorAll('.form-group').length;
		var countCond = stepGroup.querySelectorAll('div[class*="display_field_"]').length;
		var countCondVisible = Array.from(stepGroup.querySelectorAll('div[class*="display_field_"]')).filter(function(el) {
			return el.offsetParent !== null;
		}).length;

		if (countField === countCond && countCond > 0 && countCondVisible === 0) {
			stepGroup.classList.add('d-none', 'step-group-collapsible');
		}
	});
});
</script>