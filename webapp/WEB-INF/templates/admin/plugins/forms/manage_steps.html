
<#include "/admin/plugins/forms/edit_form_tabs.html" />

<#assign isOnlyOneStep=0>
<#assign hasInitial=0>
<#assign hasFinal=0>
<#assign stepId=0>
<#if step_list?size = 1>
	<#list step_list as step>
		<#assign stepId=step.id>
		<#if step.initial>
			<#assign isOnlyOneStep=isOnlyOneStep+1>
		</#if>
		<#if step.final>
			<#assign isOnlyOneStep=isOnlyOneStep+1>
		</#if>
	</#list>
</#if>
		
<#if isOnlyOneStep=2>
<script>document.location.replace("jsp/admin/plugins/forms/ManageQuestions.jsp?view=manageQuestions&id_step=${stepId}");</script>
</#if>

<@row>
	<@columns>
        <@box color='primary'>
			<@boxHeader title='${form.title!}'>
				<@aButton href='jsp/admin/plugins/forms/ManageSteps.jsp?view=createStep&id_form=${form.id}' buttonIcon='plus'  title='#i18n{forms.manage_steps.buttonAdd}' hideTitle=['all'] params='data-toggle="modal" data-target="#pubModal"' size='sm' />
				<#if form.active>
					<@aButton href='jsp/site/Portal.jsp?page=forms&view=stepView&id_form=${form.id}&init=true' title='#i18n{forms.manageForm.FOLink.label} ${form.title}' hideTitle=['all'] params='target="_blank"' buttonIcon='external-link' size='sm' />
					<@aButton href='jsp/admin/plugins/forms/MultiviewForms.jsp?current_selected_panel=forms&id_form=${form.id}' title='#i18n{forms.manageForm.MultiviewLink.label}' hideTitle=['all'] params='target="_blank"' buttonIcon='list-alt' size='sm' />
					<@button type='button' id='toggleMap' title='Voir le graphique' hideTitle=['all'] buttonIcon='sitemap' size='sm' />
				</#if>
			
			</@boxHeader>
            <@boxBody>
				<@formBreadCrumb>
					<li class="active">${form.title!}</li>
				</@formBreadCrumb>	
                <@formTabs tab='steps' />
                <@tabContent>
                    <@tabPanel id='tabpanel' active=true>
						<@table id='list' class='table-striped'>
							<tr>
								<th>#i18n{forms.manage_steps.columnTitle}</th>
								<th>#i18n{forms.manage_transitions.pageTitle}</th>
								<th>#i18n{forms.manageForm.columnActions}</th>
							</tr>
							<#list step_list as step>
								<tr>
									<td>
										<@link href='jsp/admin/plugins/forms/ManageQuestions.jsp?view=manageQuestions&id_step=${step.id}' title='${step.title}'>${step.title}</@link>
										<#if step.initial><@tag color='info'>#i18n{forms.manage_steps.columnInitial}</@tag> <#assign hasInitial=1 > </#if>
										<#if step.final><@tag color='info'>#i18n{forms.manage_steps.columnFinal}</@tag> <#assign hasFinal=1 ></#if>
									</td>
									<td>
										<#if transition_list??>
											<#list transition_list as transition>
												<#if transition.fromStep = step.id>
													<@link href='jsp/admin/plugins/forms/ManageTransitions.jsp?view=manageTransitions&id_step=${transition.fromStep}' title='#i18n{forms.modify_transition.title} ${step.title}'>
														<@icon style='chevron-right' />	${(transition.nextStepTitle)!''} ${(transition.controlTitle)!''}<#if transition.conditional> (<@icon style='question' />) </#if><@tag title='#i18n{forms.manage_transitions.columnPriority}'>${(transition.priority)!''}</@tag>
													</@link>
												</#if>	 
											</#list>
										</#if>	 
									</td>
									<@td>
										<@aButton href='jsp/admin/plugins/forms/ManageTransitions.jsp?view=manageTransitions&id_step=${step.id}' title='#i18n{forms.manage_steps.action.modifyStep} ${step.title}' hideTitle=['all'] buttonIcon='pencil' size='sm' />
										<@aButton href='jsp/admin/plugins/forms/ManageQuestions.jsp?view=manageQuestions&id_step=${step.id}' title='#i18n{forms.modify_step.tab.labelQuestions}' hideTitle=['all'] buttonIcon='list' size='sm' />
										<@aButton href='jsp/admin/plugins/forms/ManageSteps.jsp?view=confirmRemoveStep&id_step=${step.id}' title='#i18n{forms.manage_steps.action.removeStep}' hideTitle=['all'] buttonIcon='trash' color='danger' size='sm' /> 
									</@td>
								</tr>
							</#list>
							<tr>
								<td colspan="3">
									<@paginationAdmin paginator=paginator combo=1 showcount=0 />
								</td>
							</tr>
						</@table>
						<@row id='renderNetwork'>
							<@columns>
								<@btnToolbar align='right'>
									<@btnGroup size='sm'>
										<@button type='button' id='downloadPDF' title='#i18n{forms.manage_steps.pdf.download}' hideTitle=['all'] buttonIcon='download' />
										<@button type='button' id='previewPDF' buttonIcon='file-pdf' title='#i18n{forms.manage_steps.pdf.show}' hideTitle=['all'] />
									</@btnGroup>
									<@btnGroup size='sm'>
										<@button type='button' id='hierarchical' buttonIcon='sitemap' title='#i18n{forms.manage_steps.overview}' hideTitle=['all'] />
									</@btnGroup>
									<@btnGroup id='direction' size='sm'>
										<@select name='overview'>
											<option value="UD">#i18n{forms.manage_steps.overview.up.down}</option>
											<option value="DU">#i18n{forms.manage_steps.overview.down.up}</option>
											<option value="LR">#i18n{forms.manage_steps.overview.left.right}</option>
											<option value="RL">#i18n{forms.manage_steps.overview.right.left}</option>
										</@select>	
									</@btnGroup>
									<@btnGroup size='sm'>
										<@button type='button' id='save_network' buttonIcon='save' title='#i18n{forms.manage_steps.overview.save}' hideTitle=['all'] />
									</@btnGroup>
								</@btnToolbar>
								<div id="mynetwork"></div>
							</@columns>
						</@row>
					</@tabPanel>
                </@tabContent>
            </@boxBody>
        </@box>
    </@columns>
</@row>

<@formModal />

<#if hasFinal=0 && hasInitial=0 >
	<#assign msg="#i18n{forms.manage_steps.warning.no.initial.final}" />
<#elseif hasFinal=1  && hasInitial=0>	
	<#assign msg="#i18n{forms.manage_steps.warning.no.initial}" />
<#elseif hasFinal=0  && hasInitial=1>	
	<#assign msg="#i18n{forms.manage_steps.warning.no.final}" />
<#else>
	<#assign msg="" />				
</#if>

<@toastr infos=infos warnings=warnings errors=errors msg=msg  />

<@formVisualize />

<@scrollTopBtn />