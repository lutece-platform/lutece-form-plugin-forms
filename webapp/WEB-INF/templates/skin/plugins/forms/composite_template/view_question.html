<div class="row <#if question??>display_field_${question.id}_${question.iterationNumber}</#if>" displayControl="${question.id}_${question.iterationNumber}">${questionContent}</div>
<#if list_validator??>
	<input name='displayed_questions' id='${question.id}_${question.iterationNumber}' value='' hidden />
		<script>
		$(function() {
			<#assign validNames = [] />
			<#list list_validator as validator>
				<#if !validNames?seq_contains(validator.validatorBeanName)>
					<#assign validNames = validNames + [validator.validatorBeanName] />
					function validator_${validator.validatorBeanName?replace('.','_')}(inputValue,controlValue)
					{
						${validator.getJavascriptValidation()!'return true;'}
					}
				</#if>
			</#list>

			var hasCollapse=false, 
				toCollapse=null,
				stepGroup = $('.display_field_${question.id!''}_${question.iterationNumber}').parentsUntil('.step-content');
			stepGroup.each( function(){
				if( $(this).hasClass('step-group-collapsible') ){
					hasCollapse=$(this).find("div[class*='display_field_']").not(".control_invalid").length == 0, 
					toCollapse=$(this);
				}
			});
			
			var otherStepValidated = true;
			<#if other_step_validation??>
				<#if other_step_validation>
					$('.display_field_${question.id!''}_${question.iterationNumber}').show();
					$('#${question.id}_${question.iterationNumber}').val('${question.id}_${question.iterationNumber}');
				<#else>
		 			$('.display_field_${question.id!''}_${question.iterationNumber}').hide();
					$('#${question.id}_${question.iterationNumber}').val('');
					otherStepValidated = false;
				</#if>
			</#if>
			
			<#list list_control as control>
				var displayControl = ${control.listIdQuestion[0]} + "_" + ${question.iterationNumber},
				input${control.id}_${question.iterationNumber} = getInputElement(displayControl);
				input${control.id}_${question.iterationNumber}.bind('change keyup paste mouseup input', function(){
					var isQuestionDisplayed = true;
					<#list list_control as itemControl>
						var displayItemControl = ${itemControl.listIdQuestion[0]} + "_" + ${question.iterationNumber},
						input${itemControl.id}_${question.iterationNumber} = getInputElement(displayItemControl);
						var inputValue = getFieldValue(input${itemControl.id}_${question.iterationNumber});
						// AND condition : if at least 1 control value isn't present, do not display question
						if($("div[displayControl='${itemControl.listIdQuestion[0]}_${question.iterationNumber}']").hasClass("control_invalid")
								|| !validator_${itemControl.validatorName?replace('.','_')}( inputValue, '${itemControl.value}'))
						{
							isQuestionDisplayed = false;
						}
					</#list>
					if(isQuestionDisplayed && otherStepValidated)
					{
						$('.display_field_${question.id!''}_${question.iterationNumber}').removeClass("control_invalid");
						$('.display_field_${question.id!''}_${question.iterationNumber}').show();
						if( hasCollapse ){ toCollapse.show() }; // Show parent group if is in a collapse step-group
						$('#${question.id}_${question.iterationNumber}').val('${question.id}_${question.iterationNumber}');
					} else {
						$('.display_field_${question.id!''}_${question.iterationNumber}').addClass("control_invalid");
						$('.display_field_${question.id!''}_${question.iterationNumber}').hide();
						if( hasCollapse ){ toCollapse.hide(); } // Hide parent group if is in a collapse step-group
						$('#${question.id}_${question.iterationNumber}').val('');
					}
					var currentControl = "${question.id}_${question.iterationNumber}";
					var currentInput = getInputElement(currentControl);
					if ( currentInput[0] != undefined && currentInput[0].type != 'file' ){
						currentInput.change();
					}
				});
				input${control.id}_${question.iterationNumber}.change();
			</#list>
		});
		</script>
<#else>
	<input name='displayed_questions' id='${question.id}_${question.iterationNumber}' value='${question.id}_${question.iterationNumber}' hidden />
</#if>